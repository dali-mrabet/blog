<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <title>FireEye FLARE-ON challenge write-up</title>

    <meta name="apple-mobile-web-app-title" content="FireEye FLARE-ON challenge write-up">

    <link rel="apple-touch-icon" sizes="180x180" href="../assets/img/apple-touch-icon.png@v=d94913f34b">
    <link rel="icon" type="image/png" sizes="32x32" href="../assets/img/favicon-32x32.png@v=d94913f34b">
    <link rel="icon" type="image/png" sizes="16x16" href="../assets/img/favicon-16x16.png@v=d94913f34b">
    <link rel="shortcut icon" href="../favicon.ico">

    <link rel="stylesheet" href="http://fonts.googleapis.com/css?subset=latin,cyrillic-ext,latin-ext,cyrillic&amp;family=Open+Sans+Condensed:300|Merriweather:400,300,300italic,400italic,700,700italic|Roboto+Slab:400,300">
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css">

    <style type="text/css">
    a, a:visited {color: #33cc99;}
    .pagination a {color: #33cc99;}
    .gist .gist-file .gist-meta a:visited {color: #33cc99 !important;}

    a:focus, a:hover {color: #178b6b;}
    h1.post-title a:focus, h1.post-title a:hover, h1.blog-title a:focus, h1.blog-title a:hover {color: #178b6b;}
    .older-posts:hover, .newer-posts:hover {color: #178b6b;}
</style>

    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/github.min.css">
    <link rel="stylesheet" href="../assets/css/steam.css@v=d94913f34b.css">


    
    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon" />
    <link rel="canonical" href="index.html" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link rel="amphtml" href="amp/index.html" />
    
    <meta property="og:site_name" content="Mohamed Ali Mrabet " />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="FireEye FLARE-ON challenge write-up" />
    <meta property="og:description" content="Earlier this week , I have participated in Flare-On challenge which is hosted by Fire-Eye labs annually . The challenge was very comprehensive as its tasks targeted various platforms Windows(64-bit exe, Software Driver , .NET) , Android , etc ... . Unfortunatley , I started playing just 3 hours before the challenge was over , so I solved" />
    <meta property="og:url" content="http://localhost:2368/fireeye-flare-on-challenge-write-up/" />
    <meta property="article:published_time" content="2019-08-01T19:38:32.000Z" />
    <meta property="article:modified_time" content="2019-08-01T19:38:32.000Z" />
    <meta property="article:publisher" content="https://www.facebook.com/dali.mrabet.3" />
    <meta property="article:author" content="https://www.facebook.com/dali.mrabet.3" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="FireEye FLARE-ON challenge write-up" />
    <meta name="twitter:description" content="Earlier this week , I have participated in Flare-On challenge which is hosted by Fire-Eye labs annually . The challenge was very comprehensive as its tasks targeted various platforms Windows(64-bit exe, Software Driver , .NET) , Android , etc ... . Unfortunatley , I started playing just 3 hours before the challenge was over , so I solved" />
    <meta name="twitter:url" content="http://localhost:2368/fireeye-flare-on-challenge-write-up/" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="mohamed ali MRABET" />
    <meta name="twitter:site" content="@Mrabet_Dali" />
    <meta name="twitter:creator" content="@Mrabet_Dali" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Mohamed Ali Mrabet ",
        "logo": {
            "@type": "ImageObject",
            "url": "http://localhost:2368/favicon.ico",
            "width": 60,
            "height": 60
        }
    },
    "author": {
        "@type": "Person",
        "name": "mohamed ali MRABET",
        "url": "http://localhost:2368/author/mohamed/",
        "sameAs": [
            "https://www.facebook.com/dali.mrabet.3",
            "https://twitter.com/Mrabet_Dali"
        ]
    },
    "headline": "FireEye FLARE-ON challenge write-up",
    "url": "http://localhost:2368/fireeye-flare-on-challenge-write-up/",
    "datePublished": "2019-08-01T19:38:32.000Z",
    "dateModified": "2019-08-01T19:38:32.000Z",
    "description": "Earlier this week , I have participated in Flare-On challenge which is hosted by Fire-Eye labs annually . The challenge was very comprehensive as its tasks targeted various platforms Windows(64-bit exe, Software Driver , .NET) , Android , etc ... . Unfortunatley , I started playing just 3 hours before the challenge was over , so I solved",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://localhost:2368/"
    }
}
    </script>

    <meta name="generator" content="Ghost 2.26" />
    <link rel="alternate" type="application/rss+xml" title="Mohamed Ali Mrabet " href="../rss/index.html" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.14.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.14.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.14.0/themes/prism.min.css" />
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.14.0/plugins/line-numbers/prism-line-numbers.min.css" />
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.14.0/themes/prism-coy.min.css" />
</head>
<body class="post-template">

    <header id="site-head">
        <h1 class="blog-title"><a href="../index.html">Mohamed Ali Mrabet </a></h1>
        <h1 class="blog-subtitle">Thoughts, stories and ideas.</h1>
    </header>

        <nav class="menu" role="nav">
        <ul>
                    <li class="nav-home"><a href="../index.html">Home</a></li>
                    <li class="nav-github"><a href="https://github.com/dali-mrabet">github</a></li>
        </ul>
    </nav>


    <main class="content" role="main">
    <article class="post">
        <header>
        <h1 class="post-title">FireEye FLARE-ON challenge write-up</h1>
        <div class="post-meta"><time datetime="2019-08-01">01 August 2019</time></div>
        </header>
        <section class="post-content">
            <!--kg-card-begin: markdown--><p>Earlier this week , I have participated in Flare-On challenge which is hosted by Fire-Eye labs annually . The challenge was very comprehensive as its tasks targeted various platforms Windows(64-bit exe, Software Driver , .NET) , Android , etc ... . Unfortunatley , I started playing just 3 hours before the challenge was over , so I solved only the first two crackmes , just for my scrutiny I plan to solve other ones as time permits. In this Blogpost I will be talking about on how I solved the 2nd binary .The moment when I opened it with IDA , the very first thing that I have noticed is that the main function prologue stack setup is messed up just to throw off the hex-rays decompiler .<br>
At the first glance , it is obvious that it gets both <em>StdInput</em> and <em>StdOutput</em> with the help of GetStdHandle() API so that to be passed respectively as parameters to WriteFile() and Readfile() to display and read the password ,ain't nothing fuzzy here ,it is pretty straightforward. Upon further disassembling the crackme , I stumbled upon a significant block of code which it was apparent to me that it is related with the  flag generation algorithm .</p>
<!--kg-card-end: markdown--><!--kg-card-begin: html--><pre class="line-numbers"><code class="lang-c">
.text:004010A2 loc_4010A2:                           
; CODE XREF: sub_401084+4F
.text:004010A2                 mov     dx, bx
.text:004010A5                 and     dx, 3 ; and the checksum byte with 3 .text:004010A9                 mov     ax, 1C7h
.text:004010AD                 push    eax
.text:004010AE                 sahf ; loads 0x1C7 into the EFLAGS reg
.text:004010AF                 lodsb ; load the first byte into AX
.text:004010B0                 pushf ; push the EFLAG into the stack .text:004010B1                 xor     al, [esp+10h+var_C] xor AL with 7c .text:004010B5                 xchg    cl, dl
.text:004010B7                 rol     ah, cl ; rotate left by 1 .text:004010B9                 popf
.text:004010BA                 adc     al, ah ; always added by 1 .text:004010BC                 xchg    cl, dl
.text:004010BE                 xor     edx, edx
.text:004010C0                 and     eax, 0FFh ; just clear the MSB of EAX .text:004010C5                 add     bx, ax ; and then add it to ebx to be rotated latelty by 1
.text:004010C8                 scasb ; compare each hashed value by stored checksum 
.text:004010C9                 cmovnz  cx, dx conditional mov 
.text:004010CD                 pop     eax
.text:004010CE                 jecxz   short loc_4010D7
.text:004010D0                 sub     edi, 2
.text:004010D3                 loop    loc_4010A2
.text:004010D5                 jmp     short loc_4010D9`
</code></pre><!--kg-card-end: html--><!--kg-card-begin: markdown--><p>By carefully examining the encryption algorithm , the author plainly coded it in such a way that could be reversed .  I eventually came up with this python script to do the job for us :</p>
<!--kg-card-end: markdown--><!--kg-card-begin: html--><pre class="line-numbers"><code class="python">
import sys

CryptedValues =  [ 0xA8, 0x9A, 0x90, 0xB3, 0xB6, 0xBC, 0xB4, 0xAB, 0x9D, 0xAE, 0xF9, 0xB8, 0x9D, 0xB8, 0xAF, 0xBA, 0xA5, 0xA5, 0xBA, 0x9A, 0xBC, 0xB0, 0xA7, 0xC0, 0x8A, 0xAA, 0xAE, 0xAF, 0xBA, 0xA4, 0xEC, 0xAA, 0xAE, 0xEB, 0xAD, 0xAA, 0xAF]

DX = 0
BX = 0
Flag = ''

l = len(CryptedValues)

for i in range(l):
  DX = BX & 3
  DX = 1 << DX         
  a = CryptedValues[i] - DX - 1
  b = a ^ 0xC7 
  Flag += chr(b)
  
  BX += CryptedValues[i]
 
sys.stdout.write(Flag)
  
</code></pre><!--kg-card-end: html--><!--kg-card-begin: html-->Flag : a_Little_b1t_harder_plez@flare-on.com<!--kg-card-end: html-->
        </section>
        <section class="post-tags">
            
        </section>
        <section class="share">
            <p class="backtotop"><a data-scroll href="index.html#site-head"><i class="fa fa-lg fa-fw fa-angle-double-up"></i></a><a data-scroll class="backtotoptext" href="index.html#site-head"> Back to top</a></p>
            <p class="info prompt">Share</p>
            <a href="http://twitter.com/share?text=FireEye FLARE-ON challenge write-up&url=http://localhost:2368/fireeye-flare-on-challenge-write-up/" title="Share on Twitter"
                onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fa fa-2x fa-fw fa-twitter-square"></i> <span class="hidden">Twitter</span>
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:2368/fireeye-flare-on-challenge-write-up/" title="Share on Facebook"
                onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                <i class="fa fa-2x fa-fw fa-facebook-square" style="margin-left: -8px"></i> <span class="hidden">Facebook</span>
            </a>
            <a href="https://plus.google.com/share?url=http://localhost:2368/fireeye-flare-on-challenge-write-up/" title="Share on Google+"
               onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                <i class="fa fa-2x fa-fw fa-google-plus-square" style="margin-left: -8px"></i> <span class="hidden">Google+</span>
            </a>
        </section>
        <footer class="post-footer">
            <section class="author">
        <div class="authorimage" style="background: url(../assets/img/default-avatar.png@v=d94913f34b)"></div>
    <h4 class="author-name">mohamed ali MRABET</h4>
    <p class="bio"></p>
    <p class="meta">
      
      <i class="fa fa-fw fa-map-marker"></i> Montreal,Quebec
    </p>
</section>
        </footer>

    </article>
</main>


    <footer class="site-footer">
        <div class="inner">
            <section class="footer-social">
        <a href="https://www.facebook.com/dali.mrabet.3" target="_blank" rel="noopener" title="Facebook"><i class="fa fa-2x fa-fw fa-facebook"></i> <span class="hidden">Facebook</span></a>
        <a href="https://twitter.com/Mrabet_Dali" target="_blank" rel="noopener" title="Twitter"><i class="fa fa-2x fa-fw fa-twitter"></i> <span class="hidden">Twitter</span></a>
    <a href="../rss/index.html" target="_blank" rel="noopener" title="RSS"><i class="fa fa-2x fa-fw fa-rss"></i> <span class="hidden">RSS</span></a>
</section>
            <section class="footer-author">A blog by <a href="mailto:author@example.com">Author Name</a></section>
            <section class="copyright">&copy; 2019 <a href="../index.html">Mohamed Ali Mrabet </a>. All rights reserved</section>
            <section class="theme"><a href="https://github.com/epistrephein/Steam" target="_blank" rel="noopener">Steam theme</a> by Tommaso Barbato</section>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.14.0/components/prism-csharp.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.14.0/components/prism-css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.14.0/components/prism-c.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.14.0/components/prism-clike.min.js"></script>
<!-- Add additional languages here -->

    <script src="http://cdnjs.cloudflare.com/ajax/libs/smooth-scroll/9.4.3/js/smooth-scroll.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js"></script>
    <script src="../assets/js/steam.js@v=d94913f34b"></script>
</body>
</html>
